<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pelletage Maxime</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body { margin:0; padding:0; font-family:Arial,sans-serif; color:#fff; background:linear-gradient(#001f3f,#003366); overflow-x:hidden; }
header { padding:20px; background:rgba(0,0,50,0.7); position:relative; text-align:center; }
header h1 { margin:0; font-size:2em; }
header p { margin:5px 0; }
.hamburger { position:absolute; top:20px; right:20px; cursor:pointer; z-index:1001; display:flex; flex-direction:column; justify-content:space-between; width:30px; height:25px; }
.bar { height:4px; width:100%; background:#fff; border-radius:2px; animation: vibrate 1s infinite; }
@keyframes vibrate { 0%,100%{ transform: translateX(0); } 25%{ transform: translateX(-2px); } 50%{ transform: translateX(2px); } 75%{ transform: translateX(-2px); } }
nav { position:fixed; top:0; right:-250px; width:250px; height:100%; background:rgba(0,0,50,0.95); transition:0.3s; display:flex; flex-direction:column; padding-top:60px; z-index:1000; }
nav a { color:#fff; text-decoration:none; padding:15px 20px; font-size:1.1em; border-bottom:1px solid rgba(255,255,255,0.1); }
nav a:hover { background:rgba(0,191,255,0.3); }
section { display:none; padding:30px; max-width:800px; margin:50px auto; background: rgba(0,0,0,0.5); border-radius:15px; transition:0.5s; }
section.active { display:block; }
h2 { border-bottom:2px solid #00bfff; padding-bottom:10px; margin-bottom:20px; }
ul { list-style:none; padding:0; }
ul li::before { content:"‚ùÑÔ∏è "; }
input, button, textarea { width:100%; padding:12px; margin-bottom:10px; border-radius:6px; border:none; font-size:1em; }
input:focus, textarea:focus { outline:none; border:2px solid #00bfff; }
button { background:#00bfff; color:#001f3f; font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { background:#0095d1; }
.snowflake { position:fixed; top:-10px; color:white; font-size:1.5em; animation-name:fall; animation-timing-function: linear; z-index:999; }
@keyframes fall { 0%{ transform:translateY(0); opacity:1; } 100%{ transform:translateY(100vh); opacity:0.5; } }
#messageBox { text-align:center; margin-top:10px; padding:10px; border-radius:8px; display:none; font-weight:bold; }
#messageBox.success { background: rgba(0,200,0,0.6); }
#messageBox.error { background: rgba(200,0,0,0.6); }
footer { text-align:center; padding:15px; background: rgba(0,0,50,0.7); margin-top:20px; }
#distanceInfo { font-weight:bold; font-size:1.1em; margin-bottom:10px; text-align:center; }
</style>
</head>
<body>

<header>
<h1>‚ùÑÔ∏è Pelletage Maxime ‚ùÑÔ∏è</h1>
<p>Service rapide et fiable</p>
<div class="hamburger" onclick="toggleMenu()">
<div class="bar"></div>
<div class="bar"></div>
<div class="bar"></div>
</div>
</header>

<nav id="sideMenu">
<a href="#" onclick="showSection('home')">Accueil</a>
<a href="#" onclick="showSection('services')">Mes services</a>
<a href="#" onclick="showSection('demande')">Demander un pelletage</a>
<a href="#" onclick="showSection('avis')">Avis</a>
</nav>

<section id="home" class="active">
<h2>Bienvenue</h2>
<p>Service de pelletage rapide et fiable pour vos entr√©es, trottoirs et stationnements.</p>
<div id="distanceInfo">Distance autoris√©e : Cercle bleu 750m / Cercle mauve 950m</div>
<div id="map" style="height:400px; border-radius:15px; margin-bottom:15px;"></div>
<p><strong>Remarque :</strong> Les maisons <strong>hors du cercle mauve</strong> ne sont pas desservies.</p>
<h3>Nos tarifs :</h3>
<ul>
<li>Pelletage : 10$ (dans cercle bleu)</li>
<li>Pelletage : 20$ (dans cercle mauve)</li>
<li>Ajout de sel : 2$ √† 10$ selon distance</li>
</ul>
</section>

<section id="services">
<h2>Mes services</h2>
<ul>
<li>Pelletage d‚Äôentr√©es de garage</li>
<li>D√©neigement de trottoirs</li>
<li>Pelletage complet de la cour</li>
<li>Ajout de sel si besoin</li>
<li>D√©gla√ßage et sablage</li>
</ul>
</section>

<section id="demande">
<h2>Demander un pelletage</h2>
<form id="pelletageForm">
<input type="text" id="name" placeholder="Ton nom" required>
<input type="text" id="address" placeholder="Adresse compl√®te" required>
<p id="zoneMessage" style="font-weight:bold;"></p>
<input type="text" id="realAddress" placeholder="Si l'adresse automatique n'est pas correcte, √©crivez votre adresse r√©elle" />
<input type="tel" id="phone" placeholder="Num√©ro de t√©l√©phone" required pattern="[0-9]{10}">
<input type="email" id="email" placeholder="Adresse courriel" required>
<label for="date" style="margin-bottom:5px; display:block;">S√©lectionnez la date souhait√©e :</label>
<input type="date" id="date" required>
<p style="color: #ffcc00; font-weight:bold; font-size:1.1em; margin:10px 0;">
VEUILLER PR√âPARER ARGENT LIQUIDE üíµ
</p>
<button type="submit">Envoyer la demande</button>
<div id="messageBox"></div>
</form>
</section>

<section id="avis">
<h2>Avis de nos clients</h2>
<p>√âtoiles moyennes : <span id="averageStars">0</span>/5 ‚≠ê</p>
<form id="avisForm">
<input type="text" id="username" placeholder="Nom d'utilisateur" required>
<label for="stars">Nombre d'√©toiles (0 √† 5) :</label>
<input type="number" id="stars" min="0" max="5" required>
<textarea id="message" placeholder="Votre avis (optionnel)"></textarea>
<button type="submit">Envoyer l'avis</button>
</form>
<div id="avisList"></div>
</section>

<footer>
<p>¬© 2025 Pelletage Maxime ‚Äì Tous droits r√©serv√©s</p>
<button id="adminBtn" style="margin-top:10px;">Zone Admin</button>
</footer>

<script>
// Menu
function toggleMenu(){ const menu = document.getElementById('sideMenu'); menu.style.right = (menu.style.right==='0px') ? '-250px' : '0px'; }
function showSection(id){ document.querySelectorAll('section').forEach(sec=>sec.classList.remove('active')); document.getElementById(id).classList.add('active'); toggleMenu(); }

// Flocons
function createSnowflake(){ const snowflake=document.createElement("div"); snowflake.classList.add("snowflake"); snowflake.textContent="‚ùÑ"; snowflake.style.left=Math.random()*window.innerWidth+"px"; snowflake.style.animationDuration=(Math.random()*3+2)+"s"; snowflake.style.opacity=Math.random(); snowflake.style.fontSize=(Math.random()*15+10)+"px"; document.body.appendChild(snowflake); setTimeout(()=>snowflake.remove(),5000);}
setInterval(createSnowflake,200);

// Carte Leaflet
const baseLat=45.4000; 
const baseLng=-72.7330;
const rayonBleu=0.75; 
const rayonMauve=0.95;

var map=L.map('map').setView([baseLat,baseLng],15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

// Cercles bleu et mauve
L.circle([baseLat,baseLng],{
    color:'blue',
    fillColor:'#00f',
    fillOpacity:0.2,
    radius:rayonBleu*1000
}).addTo(map);

L.circle([baseLat,baseLng],{
    color:'purple',
    fillColor:'#800080',
    fillOpacity:0.1,
    radius:rayonMauve*1000
}).addTo(map);

// Fonction Nominatim
async function getCoordinates(address){
  const url=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
  const response = await fetch(url);
  const data = await response.json();
  if(data.length>0){ return {lat:parseFloat(data[0].lat), lon:parseFloat(data[0].lon)}; }
  else{return null;}
}

// Distance Haversine
function distanceKm(lat1, lon1, lat2, lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  const c=2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R*c;
}

// Formulaire pelletage
const webhookURL="https://discord.com/api/webhooks/1399488282131435580/jP1VGYSHBPhuOnQsn0F5f3hNaVNiPVcZAQ2ewdvOjoBrFGX0m7rddaaXQKd7AP2h2hdy";
const form=document.getElementById("pelletageForm"); 
const messageBox=document.getElementById("messageBox");

// G√©olocalisation automatique
window.addEventListener("load", () => {
  const addressInput=document.getElementById("address");
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(async (position)=>{
      const lat=position.coords.latitude; const lon=position.coords.longitude;
      const url=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
      const resp=await fetch(url);
      const data=await resp.json();
      if(data && data.display_name){ addressInput.value=data.display_name; }
    },()=>{ alert("Veuillez accepter la localisation pour poursuivre la demande de pelletage."); });
  } else { alert("La g√©olocalisation n'est pas support√©e par votre navigateur."); }
});

form.addEventListener("submit", async function(e){
  e.preventDefault();
  const name=document.getElementById("name").value.trim();
  const address=document.getElementById("realAddress").value.trim() || document.getElementById("address").value.trim();
  const phone=document.getElementById("phone").value.trim();
  const email=document.getElementById("email").value.trim();
  const date=document.getElementById("date").value;
  if(!name||!address||!phone||!email||!date){ messageBox.textContent="Veuillez remplir tous les champs."; messageBox.className="error"; messageBox.style.display="block"; return; }
  
  const coords=await getCoordinates(address);
  let zoneText="Adresse hors zone autoris√©e !";
  if(coords){
    const dist=distanceKm(baseLat,baseLng,coords.lat,coords.lon);
    if(dist<=rayonBleu){ zoneText="Dans le cercle bleu : 10$"; }
    else if(dist<=rayonMauve){ zoneText="Dans le cercle mauve : 20$"; }
    else{ zoneText="Hors du cercle mauve : non desservi"; }
  }
  document.getElementById("zoneMessage").textContent = zoneText;

  const content=`**Nouvelle demande de pelletage**\nNom: ${name}\nAdresse: ${address}\nT√©l√©phone: ${phone}\nEmail: ${email}\nDate souhait√©e: ${date}\nZone: ${zoneText}`;
  fetch(webhookURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content})})
  .then(()=>{ messageBox.textContent="‚úÖ Votre demande a √©t√© envoy√©e !"; messageBox.className="success"; messageBox.style.display="block"; form.reset(); })
  .catch(()=>{ messageBox.textContent="‚ùå Erreur, r√©essayez."; messageBox.className="error"; messageBox.style.display="block"; });
});

// Formulaire avis avec persistance via Admin
const avisForm=document.getElementById("avisForm");
const avisList=document.getElementById("avisList");
let avisData = JSON.parse(localStorage.getItem('avisData')) || [];

function renderAvis(){
  let html="";
  let total=0;
  avisData.forEach(a=>{
    total+=a.stars;
    html+=`<p><strong>${a.username}</strong> : ${'‚≠ê'.repeat(a.stars)}<br>${a.message}</p>`;
  });
  avisList.innerHTML=html;
  document.getElementById("averageStars").textContent=(avisData.length>0 ? (total/avisData.length).toFixed(1) : 0);
}

avisForm.addEventListener("submit", function(e){
  e.preventDefault();
  const username=document.getElementById("username").value.trim();
  const stars=parseInt(document.getElementById("stars").value);
  const message=document.getElementById("message").value.trim();
  if(!username || isNaN(stars) || stars<0 || stars>5){ alert("Nom et √©toiles valides requis."); return; }
  avisData.push({username, stars, message});
  localStorage.setItem('avisData', JSON.stringify(avisData));
  renderAvis();
  avisForm.reset();
});

renderAvis();

// Admin pour supprimer les avis
document.getElementById('adminBtn').addEventListener('click', function(){
  const user = prompt("Nom d'utilisateur :");
  const pass = prompt("Mot de passe :");
  if(user==="Maxime Riopel" && pass==="Billy0930"){
    if(confirm("Voulez-vous supprimer tous les avis ?")){
      avisData=[];
      localStorage.removeItem('avisData');
      renderAvis();
      alert("Tous les avis ont √©t√© supprim√©s.");
    }
  } else {
    alert("Acc√®s refus√©.");
  }
});
</script>

</body>
</html>
